(this["webpackJsonpyandex2018-entrance-task"]=this["webpackJsonpyandex2018-entrance-task"]||[]).push([[0],{199:function(e,t,n){},200:function(e,t,n){},201:function(e,t,n){},202:function(e,t,n){},213:function(e,t,n){},214:function(e,t,n){},215:function(e,t,n){},273:function(e,t,n){},274:function(e,t,n){},275:function(e,t,n){},279:function(e,t,n){},379:function(e,t,n){},380:function(e,t,n){},382:function(e,t,n){},383:function(e,t,n){},386:function(e,t,n){"use strict";n.r(t),n.d(t,"pickedDateStartVar",(function(){return it})),n.d(t,"pickedRoomVar",(function(){return ot}));var r=n(2),a=n(0),c=n.n(a),i=n(49),o=n.n(i),l=(n(199),n(200),n.p+"static/media/logo.d27e5f2e.svg"),s=n(14),d=n(107);n(201);var u=function(e){var t=e.children,n=e.className,a=void 0===n?"":n,c=Object(d.a)(e,["children","className"]),i=a.split(" ");return i.push("btn"),i=i.join(" ").trim(),Object(r.jsx)("button",Object(s.a)(Object(s.a)({className:i},c),{},{children:t}))},j=(n(202),n(21)),b=n(39),O=n(15),f=n(394),m=n(203),v=function(e){return Object(f.a)(Object(m.default)(e))};var h=function(){var e=Object(O.useReactiveVar)(it),t=["/"],n=Object(j.g)().pathname;return Object(r.jsx)("header",{className:"header",children:Object(r.jsxs)("div",{className:"header__inner",children:[Object(r.jsx)(b.b,{to:"/",children:Object(r.jsx)("img",{src:l,alt:"Logo"})}),Object(r.jsx)(b.b,{to:"/event/add",children:t.includes(n)?Object(r.jsx)(u,{disabled:v(e),children:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0432\u0441\u0442\u0440\u0435\u0447\u0443"}):null})]})})},p=n(11),g=n(10),x=(n(213),n(214),n(215),n(72)),y=n.n(x),S=(n(216),n(395)),w=n(388),_=n(59),N=n(220),E=n(50);function I(){return(I=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function D(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},c=Object.keys(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var C=a.createElement("path",{d:"M6 10.243L1.757 6 6 1.757h0",stroke:"#000",strokeWidth:2,fill:"none",fillRule:"evenodd",strokeLinecap:"round",strokeOpacity:.428});function k(e,t){var n=e.title,r=e.titleId,c=D(e,["title","titleId"]);return a.createElement("svg",I({width:7,height:12,xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":r},c),n?a.createElement("title",{id:r},n):null,C)}var M=a.forwardRef(k);n.p;function P(){return(P=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function F(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},c=Object.keys(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var L=a.createElement("path",{d:"M1 1.757L5.243 6 1 10.243h0",stroke:"#000",strokeWidth:2,fill:"none",fillRule:"evenodd",strokeLinecap:"round",strokeOpacity:.428});function q(e,t){var n=e.title,r=e.titleId,c=F(e,["title","titleId"]);return a.createElement("svg",P({width:7,height:12,xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":r},c),n?a.createElement("title",{id:r},n):null,L)}var H=a.forwardRef(q);n.p;function T(e,t){var n=e.value,a=e.onClick,c=e.onNextDay,i=e.onPrevDay;return Object(r.jsxs)("div",{className:"calendar",children:[Object(r.jsx)("button",{className:"calendar__btn-arrow calendar__btn-arrow--left",onClick:function(){return i()},children:Object(r.jsx)(M,{className:"calendar-btn__arrow-icon"})}),Object(r.jsx)("button",{className:"calendar__btn-dropdown",onClick:a,children:function(e){var t=e.split("/"),n=Object(p.a)(t,3),a=n[0],c=n[1],i=n[2],o=Object(S.a)(Object(w.default)(e,"MMMM/dd/yyyy",new Date,{locale:E.a}));return Object(r.jsxs)("span",{children:[parseInt(c)+" "+function(e){return e.slice(0,1).toUpperCase()+e.slice(1,3)}(a),"\xa0",Object(r.jsx)("i",{dangerouslySetInnerHTML:{__html:"&#183;"}}),"\xa0",o?"\u0421\u0435\u0433\u043e\u0434\u043d\u044f":i]})}(n)}),Object(r.jsx)("button",{className:"calendar__btn-arrow calendar__btn-arrow--right",onClick:function(){return c()},children:Object(r.jsx)(H,{className:"calendar-btn__arrow-icon"})})]})}var R=Object(a.forwardRef)(T);var $=function(e){var t=e.onChange,n=e.initialDate,c=void 0===n?new Date:n,i=Object(a.useState)(c),o=Object(p.a)(i,2),l=o[0],s=o[1];return Object(a.useEffect)((function(){t(l),console.log("Calendar date",l)}),[l]),Object(r.jsx)(y.a,{locale:E.a,dateFormat:"MMMM/dd/yyyy",selected:l,onChange:s,monthsShown:3,customInput:Object(r.jsx)(R,{onNextDay:function(){return s(Object(_.default)(l,1))},onPrevDay:function(){return s(Object(N.default)(l,1))}})})},V=n(396),A=n(399),Q=n(226),U=n(389),B=n(398),z=n(397),W=Object(w.default)("8:00","H:mm",new Date),J=Object(w.default)("23:00","H:mm",new Date),K={start:W,end:J,getCorrectDate:function(){var e=new Date;return e<Object(V.a)(e,{hours:W.getHours(),minutes:W.getMinutes()})?Object(V.a)(e,{hours:W.getHours(),minutes:W.getMinutes()}):e>Object(V.a)(e,{hours:J.getHours(),minutes:J.getMinutes()})?Object(z.a)():e}},Y=n(225),G=n(69),X=n(61);function Z(){var e=K.start,t=K.end;return 100/(Object(B.a)(t,e)+60)}function ee(e){return e*Z()}function te(e){return ee(e+30)}function ne(e){return 60*(Math.ceil(e/Z())-30)*1e3+60*K.start.getHours()*60*1e3+60*K.start.getMinutes()*1e3}var re=function(){var e=K.start,t=K.end,n=Object(O.useReactiveVar)(it),c=Object(A.a)(t,e),i=function(){var t=Array.from({length:c},(function(t,n){return(Object(Q.default)(e)+n+1).toString()})),n=Object(U.default)(e,"H:mm");return t.unshift(n),t}(),o=function(){return(new Date).toLocaleTimeString().slice(0,5)},l=Object(a.useRef)(),s=Object(a.useState)(o()),d=Object(p.a)(s,2),u=d[0],j=d[1];Object(a.useEffect)((function(){return l.current=setInterval((function(){return j(o())}),1e3),function(){return clearInterval(l.current)}}),[]);var b=Object(B.a)(Object(w.default)(u,"H:mm",new Date),e),f=!v(n);return Object(r.jsxs)("div",{className:"scedule__header",children:[Object(r.jsx)($,{onChange:function(e){!function(e){Object(S.a)(e)||(e=Object(V.a)(e,{hours:K.start.getHours(),minutes:K.start.getMinutes()})),it(e)}(e)},initialDate:n}),Object(r.jsxs)("div",{className:"timeline",children:[i.map((function(e){return Object(r.jsx)("div",{className:"timeline-label",children:e},e)})),f&&Object(r.jsx)("div",{className:"timeline__mark timeline__mark--current-time",style:{left:te(b)+"%"},children:u})]})]})};n(273);var ae=function(e){var t=e.title,n=e.subtitle;return Object(r.jsxs)("div",{className:"scedule__label",children:[Object(r.jsx)("div",{className:"scedule__label-title",children:t}),Object(r.jsx)("div",{className:"scedule__label-subtitle",children:"\u0434\u043e ".concat(n," \u0447\u0435\u043b\u043e\u0432\u0435\u043a")})]})},ce=(n(274),n(275),function(e){return Object(U.default)(e,"d MMMM",{locale:E.a})}),ie=function(e,t){var n=Object(U.default)(e,"H:mm"),r=Object(U.default)(t,"H:mm");return"".concat(n," ","\u2014"," ").concat(r)},oe=function(e){var t=function(e){return e.title}(e);return t[0].toUpperCase()+t.slice(1)},le=n(193);var se=function(e){var t=e.id,n=e.title,a=e.dateStart,c=e.dateEnd,i=e.users,o=void 0===i?[]:i,l=e.room,s=Object(j.f)(),d=o[0];return Object(r.jsx)("div",{className:"scedule-event",style:{left:te(Object(B.a)(Object(V.a)(new Date,{hours:a.getHours(),minutes:a.getMinutes()}),K.start))+"%",width:ee(Object(B.a)(c,a))+"%"},onClick:function(){return!Object(f.a)(a)&&void s.push("/event/edit/".concat(t))},"data-tip":!0,"data-for":"scedule-event__info"+t,"data-place":"bottom",children:Object(r.jsxs)(le.a,{id:"scedule-event__info"+t,className:"scedule-event__info",effect:"solid",backgroundColor:"white",children:[Object(r.jsx)("h4",{className:"scedule-event__info-title",children:n}),Object(r.jsx)("div",{className:"scedule-event__info-details",children:"".concat(ce(a),", ").concat(ie(a,c)," ","\xb7"," ").concat(oe(l))}),d&&Object(r.jsxs)("div",{className:"scedule-event__info-footer",children:[Object(r.jsx)("img",{className:"avatar-icon",src:d.avatarUrl.trim(),alt:"participant"}),Object(r.jsxs)("div",{className:"participants",children:[d.login," \u0438\u0437 ",o.length," \u0443\u0447\u0430\u0441\u0442\u043d\u0438\u043a\u043e\u0432"]})]})]})})};var de=function(e){return Object(V.a)(e,{hours:0,minutes:0})};var ue=function(e){var t,n=e.left,a=e.room,c=Object(j.f)();return Object(r.jsx)(u,{style:{height:"100%",zIndex:10,position:"absolute",left:(t=n,(t<0?0:t)+"%")},onClick:function(){var e=ne(n),t=de(it());it(Object(G.a)(t,e)),ot(a),c.push("/event/add")},children:"+"})},je=n(192);var be=function(e){var t=e.forRoom,n=void 0===t?null:t,c=e.events,i=void 0===c?[]:c,o=Object(a.useState)({show:!1,left:0}),l=Object(p.a)(o,2),u=l[0],j=l[1];return Object(r.jsxs)(je.a,{className:"scedule__timeline",onPositionChanged:function(e){var t,n=null===e||void 0===e||null===(t=e.elementDimensions)||void 0===t?void 0:t.width;if(!e.isPositionOutside&&n){var r,a=e.position.x,c=(a/(n/100)).toFixed(4),o=function(e,t){if(!t.length)return!1;var n=t[0].dateStart,r=Math.floor(e/1e3/60/60);e-=60*r*60*1e3;var a=Math.floor(e/1e3/60),c=new Date(n.getFullYear(),n.getMonth(),n.getDate(),r,a);return t.map((function(e){return Object(s.a)({},e)})).some((function(e){return e.dateStart===c||e.dateEnd===c||e.dateStart<c&&e.dateEnd>c}))}(ne(c),i),l=(r=ne(c),Object(f.a)(Object(G.a)(Object(X.default)(it()),r)));j(o||l?{show:!1}:{show:!0,left:c})}else j({show:!1})},shouldDecorateChildren:!1,children:[i.map((function(e){var t=e.id,n=e.dateStart,a=e.dateEnd,c=Object(d.a)(e,["id","dateStart","dateEnd"]);return Object(r.jsx)(se,Object(s.a)({id:t,dateStart:n,dateEnd:a},c),t)})),u.show&&Object(r.jsx)(ue,{left:u.left,room:n})]})};n(279);var Oe=function(e){var t=e.children,n=Object(a.useRef)();return Object(a.useEffect)((function(){var e=function(e){var t;return null===(t=n.current)||void 0===t?void 0:t.classList.toggle("hidden",e.target.scrollLeft>300)},t=document.querySelector(".scroll-listen-aside");return t.addEventListener("scroll",e),function(){return t.removeEventListener("scroll",e)}}),[]),Object(r.jsx)("div",{className:"scedule__aside",ref:n,children:t})},fe=n(186),me=n(45);function ve(){var e=Object(me.a)(["\n  query {\n    rooms {\n      ...roomFields\n    }\n  }\n  ","\n"]);return ve=function(){return e},e}function he(){var e=Object(me.a)(["\n  query eventsOnDate($date: Date!) {\n    eventsOnDate(date: $date) {\n      ...eventFields\n    }\n  }\n  ","\n"]);return he=function(){return e},e}function pe(){var e=Object(me.a)(["\n  mutation updateEvent($id: ID!, $input: EventInput!) {\n    updateEvent(id: $id, input: $input) {\n      ...eventFields\n    }\n  }\n  ","\n"]);return pe=function(){return e},e}function ge(){var e=Object(me.a)(["\n  mutation createEvent($input: EventInput!, $usersIds: [ID], $roomId: ID!) {\n    createEvent(input: $input, usersIds: $usersIds, roomId: $roomId) {\n      ...eventFields\n    }\n  }\n  ","\n"]);return ge=function(){return e},e}function xe(){var e=Object(me.a)(["\n  query event($id: ID!) {\n    event(id: $id) {\n      ...eventFields\n    }\n  }\n  ","\n"]);return xe=function(){return e},e}function ye(){var e=Object(me.a)(["\n  query {\n    users {\n      ...userFields\n    }\n    rooms {\n      ...roomFields\n    }\n  }\n  ","\n  ","\n"]);return ye=function(){return e},e}function Se(){var e=Object(me.a)(["\n  fragment eventFields on Event {\n    id\n    title\n    dateStart\n    dateEnd\n    room {\n      ...roomFields\n    }\n    users {\n      ...userFields\n    }\n  }\n  ","\n  ","\n"]);return Se=function(){return e},e}function we(){var e=Object(me.a)(["\n  fragment roomFields on Room {\n    id\n    title\n    capacity\n    floor\n  }\n"]);return we=function(){return e},e}function _e(){var e=Object(me.a)(["\n  fragment userFields on User {\n    id\n    login\n    avatarUrl\n    homeFloor\n  }\n"]);return _e=function(){return e},e}var Ne=Object(O.gql)(_e()),Ee=Object(O.gql)(we()),Ie=Object(O.gql)(Se(),Ee,Ne),De=Object(O.gql)(ye(),Ne,Ee),Ce=Object(O.gql)(xe(),Ie),ke=Object(O.gql)(ge(),Ie),Me=Object(O.gql)(pe(),Ie),Pe=Object(O.gql)(he(),Ie),Fe=Object(O.gql)(ve(),Ee);var Le=function(){var e=Object(m.default)(Object(O.useReactiveVar)(it));console.log("pickedDateStartVar",e);var t=Object(O.useQuery)(Pe,{variables:{date:e}}),n=t.data,a=t.loading,c=t.error,i=Object(O.useQuery)(Fe),o=i.data,l=i.loading,s=i.error;if(a||l)return"Loading...";if(c||s)return console.error(c),"Error";var d=n.eventsOnDate,u=o.rooms,j=function(){var e=u.map((function(e){return e.floor}));return Object(fe.uniq)(e)}().sort((function(e,t){return e-t})),b=function(){var e=[],t=[];return j.forEach((function(n){var a,c=(a=n,u.filter((function(e){return e.floor===a}))),i=c.map((function(e){return Object(r.jsx)(ae,{title:e.title,subtitle:e.capacity},e.id)})),o=c.map((function(e){var t=d.filter((function(t){return t.room.id===e.id}));return Object(r.jsx)(be,{forRoom:e,events:t},e.id)}));e.push.apply(e,Object(g.a)(i)),t.push.apply(t,Object(g.a)(o))})),[e,t]}(),f=Object(p.a)(b,2),v=f[0],h=f[1];return Object(r.jsxs)("div",{className:"scedule",children:[Object(r.jsx)(re,{}),Object(r.jsxs)("div",{className:"scedule__content",children:[Object(r.jsx)(Oe,{children:v}),Object(r.jsx)("div",{className:"scedule__timelines",children:h})]})]})},qe=n(255),He=n(82),Te=n(84),Re=n(190),$e=(n(379),n(380),n(51));function Ve(){return(Ve=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Ae(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},c=Object.keys(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var Qe=a.createElement("path",{d:"M0 0h24v24H0z",fill:"none"}),Ue=a.createElement("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"});function Be(e,t){var n=e.title,r=e.titleId,c=Ae(e,["title","titleId"]);return a.createElement("svg",Ve({xmlns:"http://www.w3.org/2000/svg",height:24,viewBox:"0 0 24 24",width:24,ref:t,"aria-labelledby":r},c),n?a.createElement("title",{id:r},n):null,Qe,Ue)}var ze=a.forwardRef(Be);n.p;var We=function(e){var t=e.className,n=void 0===t?"":t,c=e.candidates,i=void 0===c?[]:c,o=e.limit,l=void 0===o?i.length:o,d=e.selectedPeople,u=void 0===d?[]:d,j=e.onSelectedItemsChange,b=Object(a.useState)(""),O=Object(p.a)(b,2),f=O[0],m=O[1],v=Object($e.b)({selectedItems:u,onSelectedItemsChange:j}),h=v.getSelectedItemProps,g=v.getDropdownProps,x=v.addSelectedItem,y=v.removeSelectedItem,S=v.selectedItems,w=function(){return i.filter((function(e){return!S.some((function(t){return t.id===e.id}))&&e.login.toLowerCase().startsWith(f.toLowerCase())}))},_=Object($e.a)({inputValue:f,defaultHighlightedIndex:0,items:w(),onStateChange:function(e){var t=e.inputValue,n=e.type,r=e.selectedItem;switch(n){case $e.a.stateChangeTypes.InputChange:m(t);break;case $e.a.stateChangeTypes.InputKeyDownEnter:case $e.a.stateChangeTypes.ItemClick:case $e.a.stateChangeTypes.InputBlur:r&&S.length<l&&(m(""),x(r)),P(null)}}}),N=_.isOpen,E=_.getToggleButtonProps,I=(_.getLabelProps,_.getMenuProps),D=_.getInputProps,C=_.getComboboxProps,k=_.highlightedIndex,M=_.getItemProps,P=_.selectItem;return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsxs)("div",{className:"participant-select",children:[Object(r.jsx)("div",{children:Object(r.jsxs)("div",Object(s.a)(Object(s.a)({},C()),{},{children:[Object(r.jsx)("input",Object(s.a)({className:n},D(g({preventKeyAction:N})))),Object(r.jsx)("button",Object(s.a)(Object(s.a)({type:"button",className:"participant-select__btn"},E()),{},{"aria-label":"toggle menu",children:"\u25bc"}))]}))}),Object(r.jsx)("ul",Object(s.a)(Object(s.a)({},I()),{},{children:N&&w().map((function(e,t){return Object(r.jsx)("li",Object(s.a)(Object(s.a)({style:k===t?{backgroundColor:"#bde4ff"}:{}},M({key:e.id,index:t,onClick:function(e){return console.log(e)}})),{},{children:e.login}))}))}))]}),Object(r.jsx)("ul",{className:"participant-list",children:S.map((function(e,t){return Object(r.jsxs)("li",Object(s.a)(Object(s.a)({className:"participant-chip"},h({index:t})),{},{children:[Object(r.jsx)("img",{className:"avatar-icon",src:e.avatarUrl.trim(),alt:"avatar"}),Object(r.jsx)("div",{className:"participant-chip__name",children:e.login}),Object(r.jsx)("button",{onClick:function(t){t.preventDefault(),t.stopPropagation(),y(e)},children:Object(r.jsx)(ze,{className:"participant-chip__cross-icon"})})]}),e.id)}))})]})};n(382);var Je=function(e){var t=e.className,n=void 0===t?"":t,a=e.selectedRoom,c=e.rooms,i=void 0===c?[]:c,o=e.onSelect,l=Object($e.c)({selectedItem:a,items:i,onSelectedItemChange:function(e){var t=e.selectedItem;return o(t)}}),d=l.getToggleButtonProps,u=l.getMenuProps,j=l.getItemProps,b=l.selectedItem,O=l.isOpen,f=l.highlightedIndex,m=function(e){var t=e.title,n=e.floor;return Object(r.jsx)(r.Fragment,{children:"".concat(t,"\xa0","\xb7","\xa0").concat(n," \u042d\u0442\u0430\u0436")})};return Object(r.jsxs)("div",{className:"room-select",children:[Object(r.jsxs)("div",{children:[Object(r.jsx)("button",Object(s.a)(Object(s.a)({type:"button",className:n+" room-select__btn"},d()),{},{"aria-label":"toggle menu",children:b?m(b):"\u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043a\u043e\u043c\u043d\u0430\u0442\u0443"})),Object(r.jsx)("i",{className:"icon-arrow",children:"\u25bc"})]}),Object(r.jsx)("ul",Object(s.a)(Object(s.a)({},u()),{},{children:O&&i.map((function(e,t){return Object(r.jsx)("li",Object(s.a)(Object(s.a)({},j({item:e,index:t})),{},{style:f===t?{backgroundColor:"#bde4ff"}:{},children:m(e)}),"".concat(e.id).concat(t))}))}))]})},Ke=n(125),Ye=n(400);n(383);var Ge=function(e){var t=e.onChange,n=e.selectedDate;console.log("initial Date",n);var c=Object(a.useState)(n.dateStart),i=Object(p.a)(c,2),o=i[0],l=i[1],s=Object(a.useState)(n.dateStart),d=Object(p.a)(s,2),u=d[0],j=d[1],b=Object(a.useState)(n.dateEnd),O=Object(p.a)(b,2),f=O[0],m=O[1],v=new Date,h=Object(S.a)(o)?o:K.start,g=K.end;Object(a.useEffect)((function(){t(x())}),[o,u,f]),Object(a.useEffect)((function(){m(Object(Ke.default)(u,30))}),[u]);var x=function(){var e=de(o);return{dateStart:Object(Ye.a)(e,{hours:Object(Q.default)(u),minutes:Object(Y.default)(u)}),dateEnd:Object(Ye.a)(e,{hours:Object(Q.default)(f),minutes:Object(Y.default)(f)})}};return Object(r.jsxs)("div",{className:"input-date",children:[Object(r.jsxs)("div",{className:"field",children:[Object(r.jsx)("label",{htmlFor:"event-title",children:"\u0414\u0430\u0442\u0430"}),Object(r.jsx)(y.a,{locale:E.a,dateFormat:"dd MMMM, yyyy",selected:o,onChange:function(e){return function(e){var t;Object(S.a)(e)?(t=K.getCorrectDate(),j(t)):(t=e,j(K.start)),Object(Ke.default)(u,30),l(t)}(e)},monthsShown:3,minDate:v})]}),Object(r.jsxs)("div",{className:"field",children:[Object(r.jsx)("label",{htmlFor:"event-title",children:"\u041d\u0430\u0447\u0430\u043b\u043e"}),Object(r.jsx)(y.a,{className:"input-time",locale:E.a,selected:u,onChange:function(e){return j(e)},showTimeSelect:!0,showTimeSelectOnly:!0,timeIntervals:15,timeCaption:"\u0412\u0440\u0435\u043c\u044f",dateFormat:"H:mm",minTime:h,maxTime:g})]}),Object(r.jsx)("i",{dangerouslySetInnerHTML:{__html:"&#8212;"}}),Object(r.jsxs)("div",{className:"field",children:[Object(r.jsx)("label",{htmlFor:"event-title",children:"\u041a\u043e\u043d\u0435\u0446"}),Object(r.jsx)(y.a,{className:"input-time",locale:E.a,selected:f,onChange:function(e){return m(e)},showTimeSelect:!0,showTimeSelectOnly:!0,timeIntervals:15,timeCaption:"\u0412\u0440\u0435\u043c\u044f",dateFormat:"H:mm",minTime:Object(Ke.default)(u,30),maxTime:g})]})]})};var Xe=function(e){var t,n,a,c=e.participantSelectOptions,i=e.roomSelectOptions,o=e.participantsLimit,l=e.reactHookFormProps,s=e.onSubmit,d=e.isCreateMode,j=l.control,O=l.register,f=l.handleSubmit,m=l.errors,v=l.controller,h=l.watchParticipantList;return console.log("view render"),Object(r.jsxs)("form",{className:"form-event",onSubmit:f(s),children:[Object(r.jsxs)("div",{className:"form-event__inner",children:[Object(r.jsxs)("div",{className:"form-event__header",children:[Object(r.jsx)("h2",{className:"form-event__header-title",children:"\u041d\u043e\u0432\u0430\u044f \u0432\u0441\u0442\u0440\u0435\u0447\u0430"}),Object(r.jsx)(b.b,{to:"/",children:Object(r.jsx)(u,{className:"btn--circle",children:Object(r.jsx)(ze,{className:"btn__icon"})})})]}),Object(r.jsxs)("div",{className:"form-event__col-left",children:[Object(r.jsxs)("div",{className:"field",children:[Object(r.jsxs)("div",{className:"field-info",children:[Object(r.jsx)("label",{htmlFor:"title",children:"\u0422\u0435\u043c\u0430"}),Object(r.jsx)("div",{className:"invalid-feedback",children:null===m||void 0===m||null===(t=m.title)||void 0===t?void 0:t.message})]}),Object(r.jsx)("input",{className:(null===m||void 0===m?void 0:m.title)&&"is-invalid",id:"title",name:"title",type:"text",placeholder:"\u041e \u0447\u0435\u043c \u0431\u0443\u0434\u0435\u0442\u0435 \u0433\u043e\u0432\u043e\u0440\u0438\u0442\u044c?",ref:O})]}),Object(r.jsxs)("div",{className:"field",children:[Object(r.jsxs)("div",{className:"field-info",children:[Object(r.jsxs)("label",{htmlFor:"participant-list",children:["\u0423\u0447\u0430\u0441\u0442\u043d\u0438\u043a\u0438 (",(null===h||void 0===h?void 0:h.length)||0,"/",o,")"]}),Object(r.jsx)("div",{className:"invalid-feedback",children:null===m||void 0===m||null===(n=m.participantList)||void 0===n?void 0:n.message})]}),Object(r.jsx)(v,{name:"participantList",control:j,render:function(e){var t=e.value,n=e.onChange;return Object(r.jsx)(We,{className:(null===m||void 0===m?void 0:m.participantList)&&"is-invalid",id:"participant-list",candidates:c,selectedPeople:t,limit:o,onSelectedItemsChange:function(e){var t=e.selectedItems;return n(t)}})}})]})]}),Object(r.jsxs)("div",{className:"form-event__col-right",children:[Object(r.jsx)(v,{name:"startEndDate",control:j,render:function(e){var t=e.value,n=e.onChange;return Object(r.jsx)(Ge,{selectedDate:t,onChange:n})}}),Object(r.jsxs)("div",{className:"field",children:[Object(r.jsxs)("div",{className:"field-info",children:[Object(r.jsx)("label",{htmlFor:"room",children:"\u041a\u043e\u043c\u043d\u0430\u0442\u0430"}),Object(r.jsx)("div",{className:"invalid-feedback",children:null===m||void 0===m||null===(a=m.room)||void 0===a?void 0:a.message})]}),Object(r.jsx)(v,{name:"room",control:j,render:function(e){var t=e.value,n=e.onChange;return Object(r.jsx)(Je,{className:(null===m||void 0===m?void 0:m.room)&&"is-invalid",selectedRoom:t,rooms:i,onSelect:n})}})]})]})]}),Object(r.jsxs)("div",{className:"form-event__footer",children:[Object(r.jsx)(b.b,{to:"/",children:Object(r.jsx)(u,{className:"btn--gray",children:"\u041e\u0442\u043c\u0435\u043d\u0430"})}),Object(r.jsx)(u,{type:"submitt",children:d?"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0432\u0441\u0442\u0440\u0435\u0447\u0443":"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0432\u0441\u0442\u0440\u0435\u0447\u0443"})]})]})};var Ze=function(e){var t,n,c=e.initialData,i=e.participantSelectOptions,o=e.roomSelectOptions,l=e.onSubmit,s=e.isCreateMode;console.log("initialData",c),console.log("participantSelectOptions",i),console.log("roomSelectOptions",o),console.log("onSubmit",l),console.log("pickedDateStartVar",it());var d={title:null!==(t=null===c||void 0===c?void 0:c.title)&&void 0!==t?t:"",participantList:null!==(n=null===c||void 0===c?void 0:c.users)&&void 0!==n?n:[],room:(null===c||void 0===c?void 0:c.room)||ot()||null,startEndDate:function(){var e=c?{dateStart:new Date(c.dateStart),dateEnd:new Date(c.dateEnd)}:{dateStart:it(),dateEnd:Object(Ke.default)(it(),30)};return Object(f.a)(e.dateStart)&&(e.dateStart=K.getCorrectDate()),e}()};Object(a.useEffect)((function(){return function(){ot(null),it(Object(V.a)(it(),{hours:K.start.getHours(),minutes:K.end.getMinutes()})),console.log("reset form",it())}}),[]);var u=Object(a.useState)(0),j=Object(p.a)(u,2),b=j[0],O=j[1],m=Te.c().shape({title:Te.d().required("\u0423\u043a\u0430\u0436\u0438\u0442\u0435 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0432\u0441\u0442\u0440\u0435\u0447\u0438"),participantList:Te.a().min(1,"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0443\u0447\u0430\u0441\u0442\u043d\u0438\u043a\u043e\u0432").max(b,"\u041f\u0440\u0435\u0432\u044b\u0448\u0435\u043d\u0430 \u0432\u043c\u0435\u0441\u0442\u0438\u043c\u043e\u0441\u0442\u044c \u043a\u043e\u043c\u043d\u0430\u0442\u044b"),room:Te.b().required("\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043a\u043e\u043c\u043d\u0430\u0442\u0443")}),v=Object(He.c)({resolver:Object(Re.yupResolver)(m),defaultValues:d}),h=v.control,g=v.register,x=v.errors,y=v.handleSubmit,S=v.watch,w=v.reset;Object(a.useEffect)((function(){w(d)}),[c]);var _=S("participantList"),N=S("room");return Object(a.useEffect)((function(){N&&O(N.capacity)}),[N]),Object(r.jsx)(Xe,{participantSelectOptions:i,roomSelectOptions:o,participantsLimit:b,onSubmit:function(e){var t=e.title,n=e.startEndDate,r=e.participantList,a=e.room,i={input:{title:t,dateStart:n.dateStart,dateEnd:n.dateEnd}};s?(i.usersIds=r.map((function(e){return e.id})),i.roomId=a.id):i.id=c.id,l(i)},isCreateMode:s,reactHookFormProps:{controller:He.a,control:h,register:g,handleSubmit:y,errors:x,watchParticipantList:_}})},et=n(105),tt=n(191);function nt(e){var t=e.open,n=e.event,a=e.hide,c=e.onAccept,i=e.action;return Object(r.jsxs)(tt.a,{open:t,animationDuration:150,center:!0,showCloseIcon:!1,classNames:{overlay:"custom-modal-overlay",modal:"custom-modal"},children:["   ",Object(r.jsxs)("div",{className:"custom-modal-container",children:[Object(r.jsx)("div",{className:"form-event__modal-emoji",role:"img","aria-label":"party popper",children:"\ud83c\udf89"}),Object(r.jsx)("h2",{className:"form-event__modal-title",children:"create"===i?"\u0412\u0441\u0442\u0440\u0435\u0447\u0430 \u0441\u043e\u0437\u0434\u0430\u043d\u0430!":"\u0412\u0441\u0442\u0440\u0435\u0447\u0430 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0430!"}),Object(r.jsx)("div",{className:"form-event__modal-datatime",children:n&&function(e){var t=e.dateStart,n=e.dateEnd,r=new Date(t),a=new Date(n);return"".concat(ce(r),", ").concat(ie(r,a))}(n)}),Object(r.jsx)("div",{className:"form-event__modal-room",children:n&&function(e){var t=e.room;return"".concat(oe(t)," ","\xb7"," ").concat(t.floor," \u044d\u0442\u0430\u0436")}(n)}),Object(r.jsx)(u,{onClick:function(){a(),c()},children:"\u041e\u041a"})]})]})}function rt(){var e=function(){var e=Object(a.useState)(null),t=Object(p.a)(e,2),n=t[0],c=t[1],i=Object(et.b)((function(e){var t=e.in;return Object(r.jsx)(nt,{open:t,event:n.event,onAccept:n.onAccept,hide:d,action:n.action})}),[n]),o=Object(p.a)(i,2),l=o[0],d=o[1],u=function(e,t,n){c((function(r){return Object(s.a)(Object(s.a)({},r),{},{event:t,onAccept:n,action:e})})),l()};return{createdEventSuccess:function(e,t){u("create",e,t)},updatedEventSuccess:function(e,t){u("update",e,t)}}}(),t=Object(O.useQuery)(De),n=t.data,c=t.error,i=t.loading,o=Object(j.f)(),l=Object(O.useMutation)(ke,{onCompleted:function(t){var n=t.createEvent;return e.createdEventSuccess(n,(function(){return o.push("/")}))}}),d=Object(p.a)(l,2),u=d[0],b=d[1],f=b.loading,v=b.error,h=(b.data,Object(O.useMutation)(Me,{onCompleted:function(t){var n=t.updateEvent;return e.updatedEventSuccess(n,(function(){return o.push("/")}))}})),x=Object(p.a)(h,2),y=x[0],S=x[1],w=S.loading,_=S.error,N=(S.data,Object(j.h)().id),E=!N,I=Object(O.useQuery)(Ce,{skip:E,variables:{id:N}}),D=I.data,C=I.error,k=I.loading;if(i||f||k||w)return"Loading...";if(c||v||C||_)return"\u041f\u0440\u043e\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430";var M=n.users,P=n.rooms;return Object(r.jsx)(Ze,{initialData:null===D||void 0===D?void 0:D.event,participantSelectOptions:M,roomSelectOptions:P,onSubmit:function(e){console.log(e),E?function(e){u({variables:e,update:function(e,t){var n=t.data.createEvent;console.log(n);try{var r=Object(m.default)(Object(qe.default)(n.dateStart));console.log("date, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u0434\u043e\u043b\u0436\u043d\u0430 \u0431\u044b\u0442\u044c \u0442\u0430\u043a\u043e\u0439 \u0436\u0435, \u043a\u0430\u043a \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u0437\u0430\u043f\u0440\u043e\u0441\u0430",r);var a=e.readQuery({query:Pe,variables:{date:r}});if(null===a)return;e.writeQuery({query:Pe,variables:{date:r},data:{eventsOnDate:[].concat(Object(g.a)(a.eventsOnDate),[n])}}),console.log(e)}catch(c){console.error(c)}}})}(e):function(e){y({variables:e,update:function(e,t){var n=t.updateEvent;try{var r=Object(V.a)(Object(qe.default)(n.dateStart),{hours:0,minutes:0}),a=e.readQuery({query:Pe,variables:{date:r}});if(null===a)return;e.writeQuery({query:Pe,variables:{date:r},data:{eventsOnDate:[].concat(Object(g.a)(a.eventsOnDate),[n])}})}catch(c){console.error(c)}}})}(e)},isCreateMode:E})}var at=function(){return Object(r.jsx)(b.a,{children:Object(r.jsxs)("div",{className:"app scroll-listen-aside",children:[Object(r.jsx)(h,{}),Object(r.jsxs)(j.c,{children:[Object(r.jsx)(j.a,{path:"/",exact:!0,children:Object(r.jsx)(Le,{})}),Object(r.jsx)(j.a,{path:"/event/add",children:Object(r.jsx)(rt,{})}),Object(r.jsx)(j.a,{path:"/event/edit/:id",children:Object(r.jsx)(rt,{})})]})]})})},ct=(n(385),n(401)),it=Object(O.makeVar)(K.getCorrectDate()),ot=Object(O.makeVar)(null),lt=new O.ApolloClient({uri:"http://45.141.78.194:3060/graphql",cache:new O.InMemoryCache({typePolicies:{Event:{fields:{dateStart:{read:function(e){return new Date(e)}},dateEnd:{read:function(e){return new Date(e)}}}}}}),connectToDevTools:!0});o.a.render(Object(r.jsx)(c.a.StrictMode,{children:Object(r.jsx)(O.ApolloProvider,{client:lt,children:Object(r.jsx)(et.a,{rootComponent:ct.a,children:Object(r.jsx)(at,{})})})}),document.getElementById("root"))}},[[386,1,2]]]);
//# sourceMappingURL=main.3446114b.chunk.js.map